=====================================================================
LHAASIM  -  Software simulating the KM2A detector of the LHAASO obs -
=====================================================================

                            LHAASIM
                            --------

LhaaSim is a fast simulation of the KM2A detector (part of LHAASO observatory).
LhaaSim is a C++ software, using ROOT and CMT environment. It is a dedicated 
program containing only main processes. Its flexible structure is a precious 
advantage for an easy adaptation to different prototype of detectors.
The goal of LhaaSim is to reproduce the charge generated by particles, with an 
energy and direction given, after interaction in the ED/MD detector but also 
the time and charge distributions.



1- Installation

Before the compilation, we need to install some software and define env.
o Softwares needed :
    - ROOT : any version
    - CMT (for example v1r12p20020606)
    - CDAS : the present version uses IoSd v2r6, but can be updated
    - Corsika & Aires libraries (libAires.a & libCors.a)
 
o Environment variables to be correctly defined :
    - ROOTSYS, PATH & LD_LIBRARY_PATH as usual with ROOT 
    - AIRESLIB or/and CORSLIB
    - CMTPATH


2- Compilation

Once everything is installed, we can compile :
> cd LHAASIM/LhaaSim/v*r*/cmt;
> cmt broadcast; cmt config;
> cmt broadcast gmake;


2- Running

To run the software, we need two steps:
o The first step is conversion CorsToRoot or AiresToRoot.
	   WARNING!!!! with the present version of CorsToRoot, ONLY 2
	   ARGUMENTS ARE NEEDED, the file for groundparticles, and the
	   output file . YOU DONT NEED THE .long FILE

o The second step is run LhaaSim
	  In the same folder you will need to update the file
	   "default.inp" according to your needs
	    it will be read by LhaaSim.

==========================================================================

N.B : Fill input file
The input  file is on /LHAASIM/LhaaSim/v*r*/data/default.inp
The first part is for all modes of simulation

- mode: 
	o SHOWER  
	shower simulations reading a root file  "filename.root"
	the output file will be "Sim_filename.root"
      
	o CALIB
	 injection of particles in a single tank ,  there is one event
	 per particle injected
	 the output file name is given by the program

- simmode :
	o  DETAILED ( mode currently used )
	  the detail of the simulation of particle and follow up of photons is s
imulated
	o FAST  ( not anymore implemented in the present version)
	o SAMPLE 
	 stops the simulation at the stage of the sampling of particles in tanks


- muemmode
	o MUEM
	   give in addition to the usual traces, separate traces for muonic et 
     electromagnetic components
	o DEFAULT
	  give only the usual traces

- elecmode
	o DEFAULT
	  give the time profile of particules for each PMT and the final traces 
    for all channels
	o PM
	  give in addition the profiles in time after PM simulation for each 
    channel
	o FULL
	   give all  profiles for the intermediate steps of the
	   electronic simulation, after PM and after Front End, in
	   addition of default mode
	o SHOWSAT
	  give additionnal FADC traces where the saturation due to coding is not
    applied.

- number of events
	o for showers, number of time the same shower is simulated 
	o for calib , number of particules entering a tank


THIS SECOND PART IS RELEVANT ONLY IN CALIB MODE BUT IS ALWAYS READ BY THE PROGRAM

- runnumber

- partmode	
	o VEM		
	  only vertical and central muons of 1 GeV are injected
	o SCINTILLATOR
	  position and size  of scintillators are read in Calib.h and
	  the trajectory of particles injected  are calculated 
	o FIXEDTHETA
	   a flux of particles is injected with a given theta chosen
	   below and with phi all around the tank
	o HORIZONTAL
	  flux of horizontal muons all around the tank, inject ad mid height
	o RANDOM
	  flux of muons follwing a sin2theta distribution

- partcode
	o 1 for photons
	o 2 for electrons
	o 3 for muons

- partenergy
	o energy in GeV , if equal to zero, it will be an energy
	distribution following a spectrum defined in "Calib.h"

- parttheta
	o theta of particles relevant only in FIXEDTHETA mode

- partaddmode
	o DEFAULT  
	   only per particle par event
	o DOUBLE
	  2 particles of the same kind an energy are simulated in a
	  event, the second particle is delayed of a random time between
	  0 and 3 microseconds ( the ToT window)
	o MULTIPLE
	  N particles of same energy and kind is simulated at the same 
	  time,the number of particles is read below
	
- npartmultiple
	o see above , relevant only in MULTIPLE mode






